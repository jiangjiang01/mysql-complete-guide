# MySQL 学习大纲

> 基于《MySQL实战45讲》课程规划的系统学习路径

---

## 📚 课程概述

本课程共包含 **48讲** 内容，涵盖MySQL从基础到实战的完整知识体系。通过系统学习，你将深入理解MySQL的内部机制，掌握性能优化、高可用架构等实战技能。

---

## 🎯 学习目标

- 深入理解MySQL的底层架构和工作原理
- 掌握索引、锁、事务等核心机制
- 具备SQL性能优化能力
- 了解MySQL高可用架构设计
- 解决常见的MySQL使用问题

---

## 📖 学习路径

### 阶段一：基础篇（第1-2周）

**目标**: 建立MySQL核心概念，理解基本工作原理

- [ ] **00-环境准备.md** - MySQL环境搭建（Docker/本地安装）
- [ ] **01-架构与日志系统.md** - 第01-02讲
  - MySQL整体架构（Server层 + 存储引擎层）
  - SQL执行流程（连接器 → 分析器 → 优化器 → 执行器）
  - redo log和binlog的作用
  - 两阶段提交原理

- [ ] **02-事务隔离.md** - 第03讲
  - 四种事务隔离级别
  - MVCC（多版本并发控制）
  - 快照读 vs 当前读
  - 长事务的危害

---

### 阶段二：索引与锁（第3-4周）

**目标**: 掌握索引和锁机制的核心原理

- [ ] **03-索引原理.md** - 第04-05讲
  - B+树索引结构
  - 主键索引 vs 普通索引
  - 覆盖索引、回表、索引下推
  - 最左前缀原则
  - 前缀索引优化

- [ ] **04-锁机制.md** - 第06-08讲
  - 全局锁、表锁、行锁
  - MDL锁（元数据锁）
  - 间隙锁、Next-Key Lock
  - 两阶段锁协议
  - 死锁问题

---

### 阶段三：性能优化（第5-7周）

**目标**: 掌握MySQL实战中的性能优化技巧

- [ ] **05-索引与性能优化.md** - 第09-14讲
  - change buffer机制
  - 索引选择问题诊断
  - 字符串索引优化（前缀索引、hash字段）
  - MySQL"抖动"问题（脏页刷新）
  - 表空间碎片回收
  - count性能优化

- [ ] **06-查询优化.md** - 第16-22讲
  - ORDER BY工作原理（全字段排序 vs rowid排序）
  - 随机查询优化
  - 隐式类型转换陷阱
  - 慢查询诊断
  - 幻读与间隙锁
  - 行锁加锁规则
  - 性能优化的"饮鸩止渴"方法

---

### 阶段四：高可用架构（第8-10周）

**目标**: 掌握MySQL高可用架构设计与运维

- [ ] **07-高可用架构.md** - 第23-29讲
  - 双1配置（sync_binlog + innodb_flush_log_at_trx_commit）
  - 主从复制原理
  - binlog格式对比（ROW vs STATEMENT）
  - 半同步复制
  - 主备延迟优化（并行复制）
  - 主备切换策略（可靠性优先 vs 可用性优先）
  - 读写分离架构
  - 数据库健康检查

---

### 阶段五：进阶主题（第11-12周）

**目标**: 掌握MySQL高级特性和最佳实践

- [ ] **08-进阶主题.md** - 第31-45讲（精选）
  - 误删数据恢复（flashback、binlog恢复）
  - JOIN优化（NLJ vs BNL vs Hash Join）
  - 临时表（用户临时表 vs 内部临时表）
  - 表复制、权限管理
  - 分区表使用场景
  - 自增ID相关问题

**学习建议**: 根据实际工作需求，选择性深入学习对应的PDF课程章节

---

## 💡 学习建议

### 学习方法

1. **边学边练**：
   - 每完成一个文档，必须亲自执行所有SQL示例
   - 观察执行结果，理解背后原理
   - 尝试修改SQL，观察行为变化

2. **对照PDF深入**：
   - 实操文档提供核心知识点和SQL示例
   - 配合对应的PDF课程，理解深层原理
   - 记录疑问，通过实践验证

3. **建立知识网络**：
   - 理解各模块之间的关联（如：事务→锁→MVCC）
   - 绘制思维导图或原理图
   - 定期复习巩固

4. **解决实际问题**：
   - 将所学应用到实际项目中
   - 分析线上问题时，回顾相关知识点
   - 总结最佳实践

### 学习节奏

**推荐路径**（每天1-2小时）：
- **第1-2周**: 基础篇（环境搭建、架构、事务）
- **第3-4周**: 索引与锁
- **第5-7周**: 性能优化
- **第8-10周**: 高可用架构
- **第11-12周**: 进阶主题（选学）

**快速上手**（7天入门）：
- Day 1-2: 01-架构与日志系统
- Day 3-4: 02-事务隔离 + 03-索引原理
- Day 5-6: 04-锁机制
- Day 7: 05-索引与性能优化（第09-11讲）

### 环境准备

参考 `00-环境准备.md` 完成MySQL环境搭建。推荐使用Docker：

```bash
# 启动MySQL 8.0
docker run --name mysql-study \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v ~/mysql-data:/var/lib/mysql \
  -d mysql:8.0 \
  --character-set-server=utf8mb4 \
  --collation-server=utf8mb4_unicode_ci

# 连接MySQL
docker exec -it mysql-study mysql -uroot -p123456

# 创建学习数据库
CREATE DATABASE mysql_study DEFAULT CHARACTER SET utf8mb4;
```

---

## 📊 学习进度跟踪

- [ ] 00-环境准备（30分钟）
- [ ] 01-架构与日志系统（2-3小时）
- [ ] 02-事务隔离（1-2小时）
- [ ] 03-索引原理（2-3小时）
- [ ] 04-锁机制（2-3小时）
- [ ] 05-索引与性能优化（3-4小时）
- [ ] 06-查询优化（3-4小时）
- [ ] 07-高可用架构（3-4小时）
- [ ] 08-进阶主题（4-5小时，按需选学）

**预计总学时**: 22-30小时（核心内容）

---

## 🔖 核心知识点速查

### 架构与日志
- **MySQL架构**: Server层（连接器、分析器、优化器、执行器）+ 存储引擎层
- **redo log**: InnoDB引擎层，循环写，保证crash-safe，WAL机制
- **binlog**: Server层，追加写，用于备份恢复和主从复制
- **两阶段提交**: 保证redo log和binlog一致性

### 事务与MVCC
- **隔离级别**: READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ（MySQL默认）、SERIALIZABLE
- **MVCC**: 通过trx_id和roll_pointer实现多版本，Read View保证一致性读
- **快照读 vs 当前读**: 快照读使用MVCC不加锁，当前读读最新版本并加锁

### 索引
- **B+树**: 所有数据在叶子节点，支持范围查询
- **主键索引**: 叶子节点存完整行数据（聚簇索引）
- **普通索引**: 叶子节点存主键值，需要回表
- **覆盖索引**: 查询列都在索引中，无需回表
- **最左前缀**: 联合索引必须从最左列开始使用

### 锁机制
- **全局锁**: FTWRL，全库只读，用于备份（不推荐）
- **表锁**: LOCK TABLES，粒度大，并发差
- **MDL锁**: 自动加锁保护表结构，长事务持有导致阻塞
- **行锁**: 记录锁、间隙锁、Next-Key Lock
- **间隙锁**: 防止幻读，只在REPEATABLE READ级别生效

### 性能优化
- **change buffer**: 普通索引写入优化，减少随机IO
- **脏页刷新**: redo log写满或内存不足触发，导致"抖动"
- **表空间回收**: ALTER TABLE ... ENGINE=InnoDB 或 OPTIMIZE TABLE
- **count优化**: count(*) ≈ count(1) > count(主键) > count(字段)

### 高可用
- **双1配置**: sync_binlog=1 + innodb_flush_log_at_trx_commit=1
- **主从复制**: binlog dump线程 → IO线程 → relay log → SQL线程
- **半同步复制**: 保证至少一个从库收到binlog
- **并行复制**: slave_parallel_workers，减少主备延迟

---

## 🎓 学习检查点

完成各阶段后，检验学习效果：

### 基础篇检查点
- [ ] 能否画出MySQL的架构分层图？
- [ ] 能否解释一条SQL的完整执行流程？
- [ ] 能否说明redo log和binlog的区别和作用？
- [ ] 能否说明MySQL的四种事务隔离级别？
- [ ] 能否解释MVCC的实现原理？

### 索引与锁检查点
- [ ] 能否画出B+树索引的结构？
- [ ] 能否说明主键索引和普通索引的区别？
- [ ] 能否解释什么是覆盖索引和回表？
- [ ] 能否说明MySQL有哪些锁？各自作用范围？
- [ ] 能否解释间隙锁的作用？

### 性能优化检查点
- [ ] 能否解决索引选择错误的问题？
- [ ] 能否优化字符串字段的索引？
- [ ] 能否解释MySQL"抖动"的原因并优化？
- [ ] 能否优化count查询？
- [ ] 能否分析和解决慢查询？

### 高可用检查点
- [ ] 能否搭建MySQL主从复制环境？
- [ ] 能否说明主从复制的完整流程？
- [ ] 能否处理主备延迟问题？
- [ ] 能否设计读写分离架构？
- [ ] 能否处理主库故障切换？

---

## 📚 进阶学习资源

完成本教程后，可以进一步深入学习：

### 书籍推荐
- 《高性能MySQL》（第4版）
- 《MySQL技术内幕：InnoDB存储引擎》（第2版）
- 《数据库系统内幕》

### 官方文档
- MySQL官方文档：https://dev.mysql.com/doc/
- InnoDB存储引擎：https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html

### 实践项目
- 搭建MySQL主从复制环境
- 实现读写分离架构
- 配置MySQL高可用方案（MHA、MGR）
- 分析和优化实际项目的慢查询

### 源码学习
- MySQL源码：https://github.com/mysql/mysql-server
- 重点模块：InnoDB存储引擎、优化器

---

## 📝 学习记录

**开始时间**: ____年____月____日
**预计完成**: ____年____月____日
**实际完成**: ____年____月____日

### 学习笔记

建议记录：
- 每个阶段的学习心得
- 遇到的问题和解决方案
- 与实际工作的结合点
- 待深入研究的问题

---

> 💪 **记住**：MySQL的学习是一个持续的过程，理论结合实践才能真正掌握。坚持动手实操，在解决实际问题中不断提升！

> 🚀 **祝你学习顺利！**
