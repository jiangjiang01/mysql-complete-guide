# 10-è¡¨å…³è”æŸ¥è¯¢åŸºç¡€

> æŒæ¡JOINçš„å„ç§ç±»å‹ï¼Œå®ç°å¤šè¡¨æ•°æ®å…³è”æŸ¥è¯¢

---

## ğŸ“– æœ¬ç« ç›®æ ‡

- æŒæ¡INNER JOINå†…è¿æ¥
- æŒæ¡LEFT JOINå·¦è¿æ¥
- æŒæ¡RIGHT JOINå³è¿æ¥
- ç†è§£å„ç§JOINçš„åŒºåˆ«
- æŒæ¡å¤šè¡¨å…³è”æŸ¥è¯¢
- ç†è§£ONå’ŒWHEREçš„åŒºåˆ«

---

## ä¸€ã€JOINåŸºç¡€æ¦‚å¿µ

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦JOIN

```sql
-- ç¤ºä¾‹ï¼šæŸ¥è¯¢è®¢å•åŠç”¨æˆ·ä¿¡æ¯

-- è®¢å•è¡¨
CREATE TABLE orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    order_no VARCHAR(32) NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    total_amount BIGINT UNSIGNED NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
) ENGINE=InnoDB;

-- âŒ ä¸ä½¿ç”¨JOINï¼šéœ€è¦å¤šæ¬¡æŸ¥è¯¢
-- 1. æŸ¥è¯¢è®¢å•
SELECT * FROM orders WHERE id = 1;
-- ç»“æœï¼šuser_id = 100

-- 2. æ ¹æ®user_idæŸ¥è¯¢ç”¨æˆ·
SELECT * FROM users WHERE id = 100;
-- ç»“æœï¼šusername = 'zhangsan', email = 'zhangsan@example.com'

-- âœ… ä½¿ç”¨JOINï¼šä¸€æ¬¡æŸ¥è¯¢
SELECT
    o.order_no,
    o.total_amount,
    u.username,
    u.email
FROM orders o
JOIN users u ON o.user_id = u.id
WHERE o.id = 1;
```

### 1.2 JOINçš„ç±»å‹

```
å¸¸ç”¨JOINç±»å‹ï¼š
1. INNER JOINï¼ˆå†…è¿æ¥ï¼‰- è¿”å›ä¸¤è¡¨éƒ½åŒ¹é…çš„è®°å½•
2. LEFT JOINï¼ˆå·¦è¿æ¥ï¼‰  - è¿”å›å·¦è¡¨æ‰€æœ‰è®°å½•ï¼Œå³è¡¨åŒ¹é…çš„è®°å½•
3. RIGHT JOINï¼ˆå³è¿æ¥ï¼‰ - è¿”å›å³è¡¨æ‰€æœ‰è®°å½•ï¼Œå·¦è¡¨åŒ¹é…çš„è®°å½•
4. CROSS JOINï¼ˆäº¤å‰è¿æ¥ï¼‰- è¿”å›ç¬›å¡å°”ç§¯

ä¸å¸¸ç”¨ï¼š
5. FULL OUTER JOINï¼ˆå…¨å¤–è¿æ¥ï¼‰- MySQLä¸æ”¯æŒ
```

---

## äºŒã€INNER JOINï¼ˆå†…è¿æ¥ï¼‰

### 2.1 INNER JOINåŸºç¡€

```sql
-- INNER JOINï¼šåªè¿”å›ä¸¤è¡¨éƒ½åŒ¹é…çš„è®°å½•

-- è¯­æ³•
SELECT columns
FROM table1
INNER JOIN table2 ON table1.column = table2.column;

-- ç¤ºä¾‹ï¼šæŸ¥è¯¢è®¢å•åŠç”¨æˆ·ä¿¡æ¯
SELECT
    o.id,
    o.order_no,
    o.total_amount / 100 AS total,
    u.username,
    u.email
FROM orders o
INNER JOIN users u ON o.user_id = u.id;

-- INNERå¯ä»¥çœç•¥
SELECT
    o.id,
    o.order_no,
    u.username
FROM orders o
JOIN users u ON o.user_id = u.id;
```

**INNER JOINå›¾è§£**ï¼š

```
ordersè¡¨:          usersè¡¨:
+----+---------+   +----+----------+
| id | user_id |   | id | username |
+----+---------+   +----+----------+
| 1  | 100     |   | 100| zhangsan |
| 2  | 101     |   | 101| lisi     |
| 3  | 999     |   | 102| wangwu   |
+----+---------+   +----+----------+

INNER JOINç»“æœï¼ˆåªè¿”å›user_idåŒ¹é…çš„è®°å½•ï¼‰:
+----+---------+----------+
| id | user_id | username |
+----+---------+----------+
| 1  | 100     | zhangsan |
| 2  | 101     | lisi     |
+----+---------+----------+
-- order_id=3 å› ä¸ºuser_id=999ä¸å­˜åœ¨ï¼Œè¢«æ’é™¤
-- user_id=102 å› ä¸ºæ²¡æœ‰è®¢å•ï¼Œè¢«æ’é™¤
```

### 2.2 INNER JOINå®æˆ˜ç¤ºä¾‹

```sql
-- ç¤ºä¾‹1ï¼šæŸ¥è¯¢è®¢å•åŠå•†å“ä¿¡æ¯
SELECT
    o.order_no,
    oi.quantity,
    p.name AS product_name,
    oi.price_cents / 100 AS price
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE o.id = 1;

-- ç¤ºä¾‹2ï¼šæŸ¥è¯¢æ–‡ç« åŠä½œè€…ä¿¡æ¯
SELECT
    a.id,
    a.title,
    u.username AS author,
    a.view_count,
    a.created_at
FROM articles a
JOIN users u ON a.author_id = u.id
WHERE a.status = 2
ORDER BY a.created_at DESC
LIMIT 20;

-- ç¤ºä¾‹3ï¼šæŸ¥è¯¢è¯„è®ºåŠç”¨æˆ·ã€æ–‡ç« ä¿¡æ¯
SELECT
    c.content,
    c.created_at,
    u.username,
    a.title AS article_title
FROM comments c
JOIN users u ON c.user_id = u.id
JOIN articles a ON c.article_id = a.id
WHERE a.id = 1
ORDER BY c.created_at DESC;
```

---

## ä¸‰ã€LEFT JOINï¼ˆå·¦è¿æ¥ï¼‰

### 3.1 LEFT JOINåŸºç¡€

```sql
-- LEFT JOINï¼šè¿”å›å·¦è¡¨æ‰€æœ‰è®°å½•ï¼Œå³è¡¨åŒ¹é…çš„è®°å½•ï¼ˆä¸åŒ¹é…åˆ™ä¸ºNULLï¼‰

-- è¯­æ³•
SELECT columns
FROM table1
LEFT JOIN table2 ON table1.column = table2.column;

-- ç¤ºä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·åŠå…¶è®¢å•æ•°é‡
SELECT
    u.id,
    u.username,
    COUNT(o.id) AS order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.username;
```

**LEFT JOINå›¾è§£**ï¼š

```
usersè¡¨:           ordersè¡¨:
+----+----------+  +----+---------+
| id | username |  | id | user_id |
+----+----------+  +----+---------+
| 100| zhangsan |  | 1  | 100     |
| 101| lisi     |  | 2  | 100     |
| 102| wangwu   |  | 3  | 101     |
+----+----------+  +----+---------+

LEFT JOINç»“æœï¼ˆè¿”å›å·¦è¡¨æ‰€æœ‰è®°å½•ï¼‰:
+----+----------+---------+
| id | username | user_id |
+----+----------+---------+
| 100| zhangsan | 100     |  -- æœ‰è®¢å•
| 100| zhangsan | 100     |  -- æœ‰è®¢å•
| 101| lisi     | 101     |  -- æœ‰è®¢å•
| 102| wangwu   | NULL    |  -- æ²¡æœ‰è®¢å•ï¼Œå³è¡¨ä¸ºNULL
+----+----------+---------+
```

### 3.2 LEFT JOINå®æˆ˜ç¤ºä¾‹

```sql
-- ç¤ºä¾‹1ï¼šæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·åŠè®¢å•æ•°ï¼ˆåŒ…æ‹¬æ²¡ä¸‹è¿‡å•çš„ç”¨æˆ·ï¼‰
SELECT
    u.id,
    u.username,
    COUNT(o.id) AS order_count,
    IFNULL(SUM(o.total_amount), 0) / 100 AS total_spent
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status IN (2, 3, 4)
WHERE u.deleted_at IS NULL
GROUP BY u.id, u.username
ORDER BY total_spent DESC;

-- ç¤ºä¾‹2ï¼šæŸ¥è¯¢æ‰€æœ‰æ–‡ç« åŠè¯„è®ºæ•°ï¼ˆåŒ…æ‹¬æ²¡æœ‰è¯„è®ºçš„æ–‡ç« ï¼‰
SELECT
    a.id,
    a.title,
    COUNT(c.id) AS comment_count
FROM articles a
LEFT JOIN comments c ON a.id = c.article_id AND c.deleted_at IS NULL
WHERE a.status = 2
AND a.deleted_at IS NULL
GROUP BY a.id, a.title
ORDER BY comment_count DESC
LIMIT 20;

-- ç¤ºä¾‹3ï¼šæŸ¥è¯¢æ²¡æœ‰è®¢å•çš„ç”¨æˆ·
SELECT
    u.id,
    u.username,
    u.email,
    u.created_at
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.id IS NULL  -- å³è¡¨ä¸ºNULLï¼Œè¯´æ˜æ²¡æœ‰åŒ¹é…
AND u.deleted_at IS NULL;
```

### 3.3 LEFT JOINæŸ¥è¯¢ä¸åŒ¹é…è®°å½•

```sql
-- åœºæ™¯ï¼šæŸ¥è¯¢æ²¡æœ‰ä¸‹è¿‡è®¢å•çš„ç”¨æˆ·

SELECT
    u.id,
    u.username,
    u.email
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.id IS NULL;

-- åŸç†ï¼š
-- LEFT JOINä¼šä¿ç•™å·¦è¡¨æ‰€æœ‰è®°å½•
-- å¦‚æœå³è¡¨æ²¡æœ‰åŒ¹é…ï¼Œå³è¡¨å­—æ®µä¸ºNULL
-- WHERE o.id IS NULL è¿‡æ»¤å‡ºæ²¡æœ‰è®¢å•çš„ç”¨æˆ·

-- ç¤ºä¾‹ï¼šæŸ¥è¯¢æ²¡æœ‰æ–‡ç« çš„åˆ†ç±»
SELECT
    c.id,
    c.name
FROM categories c
LEFT JOIN articles a ON c.id = a.category_id
WHERE a.id IS NULL;
```

---

## å››ã€RIGHT JOINï¼ˆå³è¿æ¥ï¼‰

### 4.1 RIGHT JOINåŸºç¡€

```sql
-- RIGHT JOINï¼šè¿”å›å³è¡¨æ‰€æœ‰è®°å½•ï¼Œå·¦è¡¨åŒ¹é…çš„è®°å½•ï¼ˆä¸åŒ¹é…åˆ™ä¸ºNULLï¼‰

-- è¯­æ³•
SELECT columns
FROM table1
RIGHT JOIN table2 ON table1.column = table2.column;

-- ç¤ºä¾‹
SELECT
    o.id,
    o.order_no,
    u.username
FROM orders o
RIGHT JOIN users u ON o.user_id = u.id;

-- ç­‰ä»·äºLEFT JOINï¼ˆè°ƒæ¢è¡¨é¡ºåºï¼‰
SELECT
    o.id,
    o.order_no,
    u.username
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;
```

**RIGHT JOIN vs LEFT JOIN**ï¼š

```sql
-- RIGHT JOINå¾ˆå°‘ä½¿ç”¨
-- å› ä¸ºå¯ä»¥é€šè¿‡è°ƒæ¢è¡¨é¡ºåºï¼Œç”¨LEFT JOINå®ç°

-- âŒ ä¸æ¨èï¼šRIGHT JOIN
SELECT o.*, u.username
FROM orders o
RIGHT JOIN users u ON o.user_id = u.id;

-- âœ… æ¨èï¼šLEFT JOIN
SELECT o.*, u.username
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;

-- ä¸¤è€…ç»“æœç›¸åŒï¼Œä½†LEFT JOINæ›´ç¬¦åˆé˜…è¯»ä¹ æƒ¯
```

---

## äº”ã€CROSS JOINï¼ˆäº¤å‰è¿æ¥ï¼‰

### 5.1 CROSS JOINåŸºç¡€

```sql
-- CROSS JOINï¼šç¬›å¡å°”ç§¯ï¼Œè¿”å›ä¸¤è¡¨çš„æ‰€æœ‰ç»„åˆ

-- è¯­æ³•
SELECT columns
FROM table1
CROSS JOIN table2;

-- ç¤ºä¾‹
SELECT
    c.name AS color,
    s.name AS size
FROM colors c
CROSS JOIN sizes s;
```

**CROSS JOINå›¾è§£**ï¼š

```
colorsè¡¨:          sizesè¡¨:
+------+          +------+
| name |          | name |
+------+          +------+
| çº¢è‰² |          | S    |
| è“è‰² |          | M    |
| é»‘è‰² |          | L    |
+------+          +------+

CROSS JOINç»“æœï¼ˆ3 * 3 = 9è¡Œï¼‰:
+------+------+
| color| size |
+------+------+
| çº¢è‰² | S    |
| çº¢è‰² | M    |
| çº¢è‰² | L    |
| è“è‰² | S    |
| è“è‰² | M    |
| è“è‰² | L    |
| é»‘è‰² | S    |
| é»‘è‰² | M    |
| é»‘è‰² | L    |
+------+------+
```

### 5.2 CROSS JOINå®æˆ˜ç¤ºä¾‹

```sql
-- ç¤ºä¾‹1ï¼šç”Ÿæˆå•†å“SKU
SELECT
    p.name AS product_name,
    c.name AS color,
    s.name AS size,
    CONCAT(p.sku_prefix, '-', c.code, '-', s.code) AS sku
FROM products p
CROSS JOIN product_colors c
CROSS JOIN product_sizes s
WHERE p.id = 1;

-- ç¤ºä¾‹2ï¼šç”Ÿæˆæ—¥æœŸåºåˆ—
SELECT
    DATE_ADD('2024-01-01', INTERVAL t1.n * 10 + t2.n DAY) AS date
FROM
    (SELECT 0 AS n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4
     UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t1
CROSS JOIN
    (SELECT 0 AS n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4
     UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) t2
WHERE DATE_ADD('2024-01-01', INTERVAL t1.n * 10 + t2.n DAY) <= '2024-12-31'
ORDER BY date;
```

---

## å…­ã€ON vs WHERE

### 6.1 ONå’ŒWHEREçš„åŒºåˆ«

```sql
-- ONï¼šè¿æ¥æ¡ä»¶ï¼ˆå†³å®šå¦‚ä½•åŒ¹é…ï¼‰
-- WHEREï¼šè¿‡æ»¤æ¡ä»¶ï¼ˆè¿‡æ»¤ç»“æœï¼‰

-- ç¤ºä¾‹1ï¼šINNER JOINï¼ŒONå’ŒWHEREæ•ˆæœç›¸åŒ
SELECT
    o.id,
    o.order_no,
    u.username
FROM orders o
JOIN users u ON o.user_id = u.id AND u.status = 1;

-- ç­‰ä»·äº
SELECT
    o.id,
    o.order_no,
    u.username
FROM orders o
JOIN users u ON o.user_id = u.id
WHERE u.status = 1;

-- ç¤ºä¾‹2ï¼šLEFT JOINï¼ŒONå’ŒWHEREæ•ˆæœä¸åŒ
-- ONä¸­çš„æ¡ä»¶
SELECT
    u.id,
    u.username,
    COUNT(o.id) AS order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status = 2
GROUP BY u.id, u.username;
-- ç»“æœï¼šæ‰€æœ‰ç”¨æˆ·ï¼Œç»Ÿè®¡status=2çš„è®¢å•æ•°

-- WHEREä¸­çš„æ¡ä»¶
SELECT
    u.id,
    u.username,
    COUNT(o.id) AS order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.status = 2
GROUP BY u.id, u.username;
-- ç»“æœï¼šåªè¿”å›æœ‰status=2è®¢å•çš„ç”¨æˆ·
```

### 6.2 LEFT JOIN + ON vs LEFT JOIN + WHERE

```sql
-- æ•°æ®ç¤ºä¾‹
users:
+----+----------+
| id | username |
+----+----------+
| 1  | zhangsan |
| 2  | lisi     |
| 3  | wangwu   |
+----+----------+

orders:
+----+---------+--------+
| id | user_id | status |
+----+---------+--------+
| 1  | 1       | 1      |
| 2  | 1       | 2      |
| 3  | 2       | 1      |
+----+---------+--------+

-- æŸ¥è¯¢1ï¼šONä¸­è¿‡æ»¤
SELECT
    u.username,
    o.id AS order_id,
    o.status
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status = 2;

-- ç»“æœï¼š
-- zhangsan | 2    | 2
-- zhangsan | NULL | NULL  ï¼ˆstatus=1çš„è®¢å•è¢«ONè¿‡æ»¤ï¼Œä½†ç”¨æˆ·ä¿ç•™ï¼‰
-- lisi     | NULL | NULL  ï¼ˆè®¢å•è¢«ONè¿‡æ»¤ï¼Œä½†ç”¨æˆ·ä¿ç•™ï¼‰
-- wangwu   | NULL | NULL  ï¼ˆæ²¡æœ‰è®¢å•ï¼‰

-- æŸ¥è¯¢2ï¼šWHEREä¸­è¿‡æ»¤
SELECT
    u.username,
    o.id AS order_id,
    o.status
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.status = 2;

-- ç»“æœï¼š
-- zhangsan | 2    | 2
-- ï¼ˆlisiå’Œwangwuè¢«WHEREè¿‡æ»¤æ‰ï¼‰

-- æ€»ç»“ï¼š
-- ONï¼šå½±å“JOINçš„åŒ¹é…è¿‡ç¨‹ï¼ŒLEFT JOINä»ä¿ç•™å·¦è¡¨æ‰€æœ‰è®°å½•
-- WHEREï¼šè¿‡æ»¤æœ€ç»ˆç»“æœï¼Œä¼šè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•
```

---

## ä¸ƒã€å¤šè¡¨å…³è”æŸ¥è¯¢

### 7.1 ä¸‰è¡¨å…³è”

```sql
-- æŸ¥è¯¢è®¢å•ã€è®¢å•æ˜ç»†ã€å•†å“ä¿¡æ¯
SELECT
    o.order_no,
    o.total_amount / 100 AS total,
    p.name AS product_name,
    oi.quantity,
    oi.price_cents / 100 AS price,
    oi.subtotal / 100 AS subtotal
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE o.order_no = 'ORDER001';
```

### 7.2 å››è¡¨å…³è”

```sql
-- æŸ¥è¯¢è®¢å•ã€ç”¨æˆ·ã€è®¢å•æ˜ç»†ã€å•†å“ä¿¡æ¯
SELECT
    o.order_no,
    u.username,
    p.name AS product_name,
    oi.quantity,
    oi.price_cents / 100 AS price
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE o.id = 1;
```

### 7.3 å¤šå¯¹å¤šå…³è”

```sql
-- æŸ¥è¯¢æ–‡ç« åŠå…¶æ ‡ç­¾
SELECT
    a.id,
    a.title,
    GROUP_CONCAT(t.name ORDER BY t.name SEPARATOR ', ') AS tags
FROM articles a
LEFT JOIN article_tags at ON a.id = at.article_id
LEFT JOIN tags t ON at.tag_id = t.id
WHERE a.id = 1
GROUP BY a.id, a.title;

-- æŸ¥è¯¢æ ‡ç­¾åŠå…¶æ–‡ç« 
SELECT
    t.id,
    t.name AS tag_name,
    COUNT(a.id) AS article_count
FROM tags t
LEFT JOIN article_tags at ON t.id = at.tag_id
LEFT JOIN articles a ON at.article_id = a.id AND a.status = 2
GROUP BY t.id, t.name
ORDER BY article_count DESC;
```

---

## å…«ã€JOINæ€§èƒ½ä¼˜åŒ–

### 8.1 å°è¡¨é©±åŠ¨å¤§è¡¨

```sql
-- åŸåˆ™ï¼šå°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆå°è¡¨åœ¨å‰ï¼‰

-- âœ… æ¨èï¼šç”¨æˆ·è¡¨ï¼ˆå°ï¼‰é©±åŠ¨è®¢å•è¡¨ï¼ˆå¤§ï¼‰
SELECT
    u.username,
    COUNT(o.id) AS order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE u.status = 1
GROUP BY u.id, u.username;

-- âŒ ä¸æ¨èï¼šè®¢å•è¡¨ï¼ˆå¤§ï¼‰é©±åŠ¨ç”¨æˆ·è¡¨ï¼ˆå°ï¼‰
SELECT
    u.username,
    COUNT(o.id) AS order_count
FROM orders o
RIGHT JOIN users u ON o.user_id = u.id
WHERE u.status = 1
GROUP BY u.id, u.username;
```

### 8.2 ç´¢å¼•ä¼˜åŒ–

```sql
-- ç¡®ä¿JOINå­—æ®µæœ‰ç´¢å¼•

-- è®¢å•è¡¨
CREATE TABLE orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,

    INDEX idx_user_id (user_id)  -- JOINå­—æ®µåŠ ç´¢å¼•
) ENGINE=InnoDB;

-- è®¢å•æ˜ç»†è¡¨
CREATE TABLE order_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    order_id BIGINT UNSIGNED NOT NULL,
    product_id BIGINT UNSIGNED NOT NULL,

    INDEX idx_order_id (order_id),    -- JOINå­—æ®µåŠ ç´¢å¼•
    INDEX idx_product_id (product_id) -- JOINå­—æ®µåŠ ç´¢å¼•
) ENGINE=InnoDB;
```

### 8.3 é¿å…JOINè¿‡å¤šè¡¨

```sql
-- âŒ ä¸æ¨èï¼šJOINå¤ªå¤šè¡¨ï¼ˆæ€§èƒ½å·®ï¼‰
SELECT *
FROM t1
JOIN t2 ON t1.id = t2.t1_id
JOIN t3 ON t2.id = t3.t2_id
JOIN t4 ON t3.id = t4.t3_id
JOIN t5 ON t4.id = t5.t4_id
JOIN t6 ON t5.id = t6.t5_id;

-- âœ… æ¨èï¼š
-- 1. å‡å°‘JOINæ•°é‡
-- 2. ä½¿ç”¨å†—ä½™å­—æ®µ
-- 3. åˆ†æ­¥æŸ¥è¯¢
```

---

## ä¹ã€å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šè®¢å•è¯¦æƒ…é¡µ

```sql
-- æŸ¥è¯¢è®¢å•ã€ç”¨æˆ·ã€è®¢å•æ˜ç»†ã€å•†å“ä¿¡æ¯
SELECT
    o.order_no,
    o.total_amount / 100 AS total,
    o.status,
    o.created_at,

    u.username,
    u.email,

    JSON_ARRAYAGG(
        JSON_OBJECT(
            'product_name', p.name,
            'quantity', oi.quantity,
            'price', oi.price_cents / 100,
            'subtotal', oi.subtotal / 100
        )
    ) AS items
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE o.order_no = 'ORDER001'
GROUP BY o.id, o.order_no, o.total_amount, o.status, o.created_at, u.username, u.email;
```

### æ¡ˆä¾‹2ï¼šç”¨æˆ·æ¶ˆè´¹ç»Ÿè®¡

```sql
-- æŸ¥è¯¢ç”¨æˆ·åŠå…¶æ¶ˆè´¹ç»Ÿè®¡
SELECT
    u.id,
    u.username,
    u.email,
    COUNT(o.id) AS order_count,
    IFNULL(SUM(o.total_amount), 0) / 100 AS total_spent,
    IFNULL(AVG(o.total_amount), 0) / 100 AS avg_order_amount,
    MAX(o.created_at) AS last_order_at
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status IN (2, 3, 4)
WHERE u.deleted_at IS NULL
GROUP BY u.id, u.username, u.email
HAVING order_count > 0
ORDER BY total_spent DESC
LIMIT 100;
```

### æ¡ˆä¾‹3ï¼šå•†å“é”€å”®æ’è¡Œ

```sql
-- æŸ¥è¯¢å•†å“é”€å”®æ’è¡Œ
SELECT
    p.id,
    p.name,
    c.name AS category_name,
    IFNULL(SUM(oi.quantity), 0) AS total_sales,
    IFNULL(SUM(oi.subtotal), 0) / 100 AS total_revenue,
    COUNT(DISTINCT oi.order_id) AS order_count
FROM products p
LEFT JOIN categories c ON p.category_id = c.id
LEFT JOIN order_items oi ON p.id = oi.product_id
WHERE p.deleted_at IS NULL
GROUP BY p.id, p.name, c.name
ORDER BY total_sales DESC
LIMIT 50;
```

---

## åã€å¸¸è§é”™è¯¯

### 10.1 å¿˜è®°JOINæ¡ä»¶

```sql
-- âŒ é”™è¯¯ï¼šå¿˜è®°ONæ¡ä»¶
SELECT *
FROM orders o
JOIN users u;
-- ç»“æœï¼šç¬›å¡å°”ç§¯ï¼Œæ¯ä¸ªè®¢å•åŒ¹é…æ‰€æœ‰ç”¨æˆ·

-- âœ… æ­£ç¡®ï¼šåŠ ONæ¡ä»¶
SELECT *
FROM orders o
JOIN users u ON o.user_id = u.id;
```

### 10.2 SELECT *å¯¼è‡´å­—æ®µé‡å¤

```sql
-- âŒ ä¸æ¨èï¼šSELECT *
SELECT *
FROM orders o
JOIN users u ON o.user_id = u.id;
-- ç»“æœï¼šidå­—æ®µé‡å¤ï¼ˆorders.id å’Œ users.idï¼‰

-- âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šå­—æ®µ
SELECT
    o.id AS order_id,
    o.order_no,
    u.id AS user_id,
    u.username
FROM orders o
JOIN users u ON o.user_id = u.id;
```

### 10.3 LEFT JOINè¯¯ç”¨WHERE

```sql
-- âŒ é”™è¯¯ï¼šWHEREæŠŠLEFT JOINå˜æˆINNER JOIN
SELECT
    u.username,
    o.order_no
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.status = 2;
-- ç»“æœï¼šåªè¿”å›æœ‰status=2è®¢å•çš„ç”¨æˆ·ï¼ˆLEFT JOINå¤±æ•ˆï¼‰

-- âœ… æ­£ç¡®ï¼šæ¡ä»¶æ”¾åœ¨ONä¸­
SELECT
    u.username,
    o.order_no
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status = 2;
-- ç»“æœï¼šè¿”å›æ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ²¡æœ‰status=2è®¢å•çš„ç”¨æˆ·
```

---

## åä¸€ã€æœ¬ç« æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **INNER JOIN**ï¼š
   - åªè¿”å›ä¸¤è¡¨éƒ½åŒ¹é…çš„è®°å½•
   - æœ€å¸¸ç”¨çš„JOINç±»å‹

2. **LEFT JOIN**ï¼š
   - è¿”å›å·¦è¡¨æ‰€æœ‰è®°å½•
   - å³è¡¨ä¸åŒ¹é…åˆ™ä¸ºNULL
   - é€‚åˆæŸ¥è¯¢"åŒ…æ‹¬æ²¡æœ‰å…³è”çš„è®°å½•"

3. **RIGHT JOIN**ï¼š
   - è¿”å›å³è¡¨æ‰€æœ‰è®°å½•
   - å®é™…å¾ˆå°‘ä½¿ç”¨ï¼ˆç”¨LEFT JOINä»£æ›¿ï¼‰

4. **CROSS JOIN**ï¼š
   - ç¬›å¡å°”ç§¯
   - é€‚åˆç”Ÿæˆç»„åˆæ•°æ®

5. **ON vs WHERE**ï¼š
   - ONï¼šè¿æ¥æ¡ä»¶
   - WHEREï¼šè¿‡æ»¤ç»“æœ
   - LEFT JOINä¸­åŒºåˆ«å¾ˆå¤§

6. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å°è¡¨é©±åŠ¨å¤§è¡¨
   - JOINå­—æ®µåŠ ç´¢å¼•
   - é¿å…JOINè¿‡å¤šè¡¨

### ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… ç†è§£å„ç§JOINçš„åŒºåˆ«
- âœ… ç¼–å†™å¤šè¡¨å…³è”æŸ¥è¯¢
- âœ… æ­£ç¡®ä½¿ç”¨ONå’ŒWHERE
- âœ… ä¼˜åŒ–JOINæŸ¥è¯¢æ€§èƒ½

ä¸‹ä¸€èŠ‚ï¼š[11-å­æŸ¥è¯¢](./11-å­æŸ¥è¯¢.md)
