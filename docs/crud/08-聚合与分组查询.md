# 08-èšåˆä¸åˆ†ç»„æŸ¥è¯¢

> æŒæ¡MySQLçš„èšåˆå‡½æ•°å’ŒGROUP BYåˆ†ç»„æŸ¥è¯¢ï¼Œè¿›è¡Œæ•°æ®ç»Ÿè®¡åˆ†æ

---

## ğŸ“– æœ¬ç« ç›®æ ‡

- æŒæ¡COUNTã€SUMã€AVGã€MAXã€MINç­‰èšåˆå‡½æ•°
- æŒæ¡GROUP BYåˆ†ç»„æŸ¥è¯¢
- æŒæ¡HAVINGè¿‡æ»¤åˆ†ç»„ç»“æœ
- ç†è§£èšåˆæŸ¥è¯¢çš„å¸¸è§é”™è¯¯
- æŒæ¡åˆ†ç»„ç»Ÿè®¡çš„å®æˆ˜åº”ç”¨

---

## ä¸€ã€èšåˆå‡½æ•°

### 1.1 COUNTï¼ˆè®¡æ•°ï¼‰

```sql
-- COUNT(*)ï¼šç»Ÿè®¡æ€»è¡Œæ•°ï¼ˆåŒ…æ‹¬NULLï¼‰
SELECT COUNT(*) AS total_users FROM users;

-- COUNT(1)ï¼šç»Ÿè®¡æ€»è¡Œæ•°ï¼ˆä¸COUNT(*)æ€§èƒ½ç›¸åŒï¼‰
SELECT COUNT(1) AS total_users FROM users;

-- COUNT(å­—æ®µ)ï¼šç»Ÿè®¡éNULLå€¼çš„è¡Œæ•°
SELECT COUNT(phone) AS users_with_phone FROM users;
SELECT COUNT(deleted_at) AS deleted_users FROM users;

-- COUNT(DISTINCT å­—æ®µ)ï¼šç»Ÿè®¡ä¸é‡å¤å€¼çš„æ•°é‡
SELECT COUNT(DISTINCT city) AS city_count FROM users;
SELECT COUNT(DISTINCT email) AS unique_emails FROM users;
```

**COUNTçš„åŒºåˆ«**ï¼š

```sql
-- ç¤ºä¾‹æ•°æ®
CREATE TABLE test_count (
    id INT,
    score INT
);

INSERT INTO test_count VALUES
(1, 80),
(2, NULL),
(3, 90);

-- å¯¹æ¯”
SELECT
    COUNT(*) AS count_star,      -- 3ï¼ˆæ‰€æœ‰è¡Œï¼‰
    COUNT(1) AS count_1,          -- 3ï¼ˆæ‰€æœ‰è¡Œï¼‰
    COUNT(id) AS count_id,        -- 3ï¼ˆidéƒ½ä¸ä¸ºNULLï¼‰
    COUNT(score) AS count_score   -- 2ï¼ˆscoreæœ‰1ä¸ªNULLï¼‰
FROM test_count;
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- `COUNT(*)` â‰ˆ `COUNT(1)` > `COUNT(ä¸»é”®)` > `COUNT(å­—æ®µ)`
- æ¨èä½¿ç”¨ `COUNT(*)` æˆ– `COUNT(1)`

### 1.2 SUMï¼ˆæ±‚å’Œï¼‰

```sql
-- ç»Ÿè®¡æ€»é”€å”®é¢
SELECT SUM(total_amount) AS total_sales FROM orders;

-- ç»Ÿè®¡æŸå•†å“çš„æ€»é”€é‡
SELECT SUM(quantity) AS total_quantity
FROM order_items
WHERE product_id = 1;

-- SUMå¿½ç•¥NULLå€¼
SELECT SUM(score) FROM test_count;  -- 80 + 90 = 170ï¼ˆå¿½ç•¥NULLï¼‰

-- SUM + CASE WHENï¼šæ¡ä»¶æ±‚å’Œ
SELECT
    SUM(CASE WHEN status = 1 THEN total_amount ELSE 0 END) AS pending_amount,
    SUM(CASE WHEN status = 2 THEN total_amount ELSE 0 END) AS paid_amount
FROM orders;
```

### 1.3 AVGï¼ˆå¹³å‡å€¼ï¼‰

```sql
-- ç»Ÿè®¡å¹³å‡åˆ†æ•°
SELECT AVG(score) AS avg_score FROM test_count;  -- (80 + 90) / 2 = 85

-- ç»Ÿè®¡å¹³å‡è®¢å•é‡‘é¢
SELECT AVG(total_amount) AS avg_order_amount FROM orders;

-- AVGå¿½ç•¥NULLå€¼
-- å¦‚æœéœ€è¦å°†NULLå½“ä½œ0è®¡ç®—
SELECT AVG(IFNULL(score, 0)) AS avg_score FROM test_count;
-- (80 + 0 + 90) / 3 = 56.67

-- å››èˆäº”å…¥
SELECT ROUND(AVG(price_cents) / 100, 2) AS avg_price FROM products;
```

### 1.4 MAX / MINï¼ˆæœ€å¤§å€¼ / æœ€å°å€¼ï¼‰

```sql
-- æœ€é«˜åˆ†
SELECT MAX(score) AS max_score FROM students;

-- æœ€ä½ä»·æ ¼
SELECT MIN(price_cents) AS min_price FROM products;

-- æœ€æ—©æ³¨å†Œæ—¶é—´
SELECT MIN(created_at) AS first_register FROM users;

-- æœ€æ™šè®¢å•
SELECT MAX(created_at) AS latest_order FROM orders;

-- MAX/MINä¹Ÿå¿½ç•¥NULLå€¼
SELECT MAX(score) FROM test_count;  -- 90
SELECT MIN(score) FROM test_count;  -- 80
```

### 1.5 GROUP_CONCATï¼ˆåˆ†ç»„æ‹¼æ¥ï¼‰

```sql
-- æ‹¼æ¥æ‰€æœ‰å€¼
SELECT GROUP_CONCAT(username) AS all_users FROM users;
-- ç»“æœï¼š'zhangsan,lisi,wangwu'

-- æŒ‡å®šåˆ†éš”ç¬¦
SELECT GROUP_CONCAT(username SEPARATOR '; ') AS all_users FROM users;
-- ç»“æœï¼š'zhangsan; lisi; wangwu'

-- æ’åºåæ‹¼æ¥
SELECT GROUP_CONCAT(username ORDER BY created_at DESC) AS users FROM users;

-- å»é‡æ‹¼æ¥
SELECT GROUP_CONCAT(DISTINCT city) AS cities FROM users;

-- é™åˆ¶é•¿åº¦ï¼ˆé»˜è®¤1024ï¼‰
SET SESSION group_concat_max_len = 10000;
SELECT GROUP_CONCAT(username) FROM users;

-- å®æˆ˜ç¤ºä¾‹ï¼šæŸ¥è¯¢æ–‡ç« åŠå…¶æ‰€æœ‰æ ‡ç­¾
SELECT
    a.id,
    a.title,
    GROUP_CONCAT(t.name ORDER BY t.name SEPARATOR ', ') AS tags
FROM articles a
LEFT JOIN article_tags at ON a.id = at.article_id
LEFT JOIN tags t ON at.tag_id = t.id
GROUP BY a.id, a.title;
```

---

## äºŒã€GROUP BYåˆ†ç»„æŸ¥è¯¢

### 2.1 å•å­—æ®µåˆ†ç»„

```sql
-- ç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„ç”¨æˆ·æ•°é‡
SELECT
    city,
    COUNT(*) AS user_count
FROM users
GROUP BY city;

-- ç»“æœç¤ºä¾‹ï¼š
-- city     | user_count
-- ---------|------------
-- åŒ—äº¬     | 100
-- ä¸Šæµ·     | 80
-- å¹¿å·     | 60

-- ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„å•†å“æ•°é‡
SELECT
    category_id,
    COUNT(*) AS product_count,
    SUM(stock) AS total_stock,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY category_id;
```

### 2.2 å¤šå­—æ®µåˆ†ç»„

```sql
-- ç»Ÿè®¡æ¯ä¸ªåŸå¸‚ã€æ¯ä¸ªå¹´é¾„æ®µçš„ç”¨æˆ·æ•°é‡
SELECT
    city,
    CASE
        WHEN age < 18 THEN 'æœªæˆå¹´'
        WHEN age >= 18 AND age < 60 THEN 'æˆå¹´'
        ELSE 'è€å¹´'
    END AS age_group,
    COUNT(*) AS user_count
FROM users
GROUP BY city, age_group;

-- ç»“æœç¤ºä¾‹ï¼š
-- city | age_group | user_count
-- -----|-----------|------------
-- åŒ—äº¬ | æœªæˆå¹´    | 10
-- åŒ—äº¬ | æˆå¹´      | 80
-- åŒ—äº¬ | è€å¹´      | 10
-- ä¸Šæµ· | æœªæˆå¹´    | 8
-- ä¸Šæµ· | æˆå¹´      | 60
```

### 2.3 GROUP BY + ORDER BY

```sql
-- ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„å•†å“æ•°é‡ï¼ŒæŒ‰æ•°é‡é™åº
SELECT
    category_id,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id
ORDER BY product_count DESC;

-- ç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„ç”¨æˆ·æ•°é‡ï¼ŒæŒ‰åŸå¸‚åæ’åº
SELECT
    city,
    COUNT(*) AS user_count
FROM users
GROUP BY city
ORDER BY city ASC;

-- å¯ä»¥æŒ‰èšåˆç»“æœæ’åº
SELECT
    category_id,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY category_id
ORDER BY avg_price DESC;
```

### 2.4 GROUP BY + LIMIT

```sql
-- ç»Ÿè®¡ç”¨æˆ·æ•°æœ€å¤šçš„å‰5ä¸ªåŸå¸‚
SELECT
    city,
    COUNT(*) AS user_count
FROM users
GROUP BY city
ORDER BY user_count DESC
LIMIT 5;

-- ç»Ÿè®¡é”€é‡æœ€é«˜çš„å‰10ä¸ªå•†å“
SELECT
    product_id,
    SUM(quantity) AS total_sales
FROM order_items
GROUP BY product_id
ORDER BY total_sales DESC
LIMIT 10;
```

### 2.5 WITH ROLLUPï¼ˆåˆ†ç»„æ±‡æ€»ï¼‰

```sql
-- ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„å•†å“æ•°é‡ï¼Œå¹¶æ±‡æ€»
SELECT
    category_id,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id WITH ROLLUP;

-- ç»“æœç¤ºä¾‹ï¼š
-- category_id | product_count
-- ------------|---------------
-- 1           | 50
-- 2           | 30
-- 3           | 20
-- NULL        | 100ï¼ˆæ±‡æ€»è¡Œï¼‰

-- å¤šçº§åˆ†ç»„æ±‡æ€»
SELECT
    category_id,
    status,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id, status WITH ROLLUP;

-- ç»“æœç¤ºä¾‹ï¼š
-- category_id | status | product_count
-- ------------|--------|---------------
-- 1           | 1      | 40
-- 1           | 2      | 10
-- 1           | NULL   | 50ï¼ˆåˆ†ç±»1æ±‡æ€»ï¼‰
-- 2           | 1      | 25
-- 2           | 2      | 5
-- 2           | NULL   | 30ï¼ˆåˆ†ç±»2æ±‡æ€»ï¼‰
-- NULL        | NULL   | 100ï¼ˆæ€»æ±‡æ€»ï¼‰
```

---

## ä¸‰ã€HAVINGè¿‡æ»¤

### 3.1 HAVING vs WHERE

```sql
-- WHEREï¼šè¿‡æ»¤åŸå§‹æ•°æ®ï¼ˆåˆ†ç»„å‰ï¼‰
-- HAVINGï¼šè¿‡æ»¤åˆ†ç»„ç»“æœï¼ˆåˆ†ç»„åï¼‰

-- âŒ é”™è¯¯ï¼šWHEREä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°
SELECT city, COUNT(*) AS user_count
FROM users
WHERE COUNT(*) > 10  -- é”™è¯¯ï¼
GROUP BY city;

-- âœ… æ­£ç¡®ï¼šä½¿ç”¨HAVING
SELECT city, COUNT(*) AS user_count
FROM users
GROUP BY city
HAVING COUNT(*) > 10;

-- WHERE + HAVINGç»„åˆ
SELECT city, COUNT(*) AS user_count
FROM users
WHERE status = 1  -- WHEREï¼šè¿‡æ»¤status=1çš„ç”¨æˆ·
GROUP BY city
HAVING COUNT(*) > 10;  -- HAVINGï¼šè¿‡æ»¤ç”¨æˆ·æ•°>10çš„åŸå¸‚
```

### 3.2 HAVINGä½¿ç”¨åœºæ™¯

```sql
-- æŸ¥è¯¢è®¢å•æ•°è¶…è¿‡10çš„ç”¨æˆ·
SELECT
    user_id,
    COUNT(*) AS order_count
FROM orders
GROUP BY user_id
HAVING COUNT(*) > 10;

-- æŸ¥è¯¢å¹³å‡ä»·æ ¼è¶…è¿‡100å…ƒçš„åˆ†ç±»
SELECT
    category_id,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY category_id
HAVING AVG(price_cents) > 10000;

-- æŸ¥è¯¢æ€»é”€å”®é¢è¶…è¿‡10000çš„å•†å“
SELECT
    product_id,
    SUM(subtotal) AS total_sales
FROM order_items
GROUP BY product_id
HAVING SUM(subtotal) > 1000000;

-- å¤šä¸ªHAVINGæ¡ä»¶
SELECT
    category_id,
    COUNT(*) AS product_count,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY category_id
HAVING COUNT(*) > 10
AND AVG(price_cents) > 10000;
```

---

## å››ã€åˆ†ç»„æŸ¥è¯¢å¸¸è§é”™è¯¯

### 4.1 SELECTéåˆ†ç»„å­—æ®µé”™è¯¯

```sql
-- âŒ é”™è¯¯ï¼šSELECTäº†éåˆ†ç»„å­—æ®µ
SELECT
    category_id,
    name,  -- âŒ nameä¸åœ¨GROUP BYä¸­ï¼Œä¹Ÿä¸æ˜¯èšåˆå‡½æ•°
    COUNT(*) AS product_count
FROM products
GROUP BY category_id;

-- MySQL 5.7.5+é»˜è®¤å¯ç”¨ONLY_FULL_GROUP_BYæ¨¡å¼ï¼Œä¼šæŠ¥é”™ï¼š
-- ERROR: 'products.name' isn't in GROUP BY

-- âœ… æ­£ç¡®æ–¹å¼1ï¼šåªSELECTåˆ†ç»„å­—æ®µå’Œèšåˆå­—æ®µ
SELECT
    category_id,
    COUNT(*) AS product_count,
    AVG(price_cents) AS avg_price
FROM products
GROUP BY category_id;

-- âœ… æ­£ç¡®æ–¹å¼2ï¼šå°†éåˆ†ç»„å­—æ®µä¹ŸåŠ å…¥GROUP BY
SELECT
    category_id,
    name,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id, name;

-- âœ… æ­£ç¡®æ–¹å¼3ï¼šä½¿ç”¨èšåˆå‡½æ•°
SELECT
    category_id,
    GROUP_CONCAT(name) AS product_names,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id;

-- âœ… æ­£ç¡®æ–¹å¼4ï¼šä½¿ç”¨ANY_VALUEï¼ˆMySQL 5.7.5+ï¼‰
SELECT
    category_id,
    ANY_VALUE(name) AS any_product_name,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id;
```

### 4.2 WHEREä¸­ä½¿ç”¨èšåˆå‡½æ•°é”™è¯¯

```sql
-- âŒ é”™è¯¯ï¼šWHEREä¸­ä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°
SELECT city, COUNT(*) AS user_count
FROM users
WHERE COUNT(*) > 10  -- é”™è¯¯ï¼
GROUP BY city;

-- âœ… æ­£ç¡®ï¼šä½¿ç”¨HAVING
SELECT city, COUNT(*) AS user_count
FROM users
GROUP BY city
HAVING COUNT(*) > 10;
```

### 4.3 ORDER BYéåˆ†ç»„å­—æ®µ

```sql
-- âŒ é”™è¯¯ï¼šORDER BYäº†éåˆ†ç»„å­—æ®µ
SELECT
    category_id,
    COUNT(*) AS product_count
FROM products
GROUP BY category_id
ORDER BY price_cents;  -- âŒ price_centsä¸åœ¨GROUP BYä¸­

-- âœ… æ­£ç¡®ï¼šORDER BYåˆ†ç»„å­—æ®µæˆ–èšåˆå­—æ®µ
SELECT
    category_id,
    COUNT(*) AS product_count,
    AVG(price_cents) AS avg_price
FROM products
GROUP BY category_id
ORDER BY avg_price DESC;
```

---

## äº”ã€åˆ†ç»„ç»Ÿè®¡å®æˆ˜

### 5.1 ç»Ÿè®¡æ¯æ—¥è®¢å•æ•°å’Œé”€å”®é¢

```sql
SELECT
    DATE(created_at) AS order_date,
    COUNT(*) AS order_count,
    SUM(total_amount) / 100 AS total_sales
FROM orders
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(created_at)
ORDER BY order_date DESC;
```

### 5.2 ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„å•†å“ç»Ÿè®¡

```sql
SELECT
    c.name AS category_name,
    COUNT(p.id) AS product_count,
    SUM(p.stock) AS total_stock,
    AVG(p.price_cents) / 100 AS avg_price,
    MIN(p.price_cents) / 100 AS min_price,
    MAX(p.price_cents) / 100 AS max_price
FROM categories c
LEFT JOIN products p ON c.id = p.category_id
GROUP BY c.id, c.name
ORDER BY product_count DESC;
```

### 5.3 ç»Ÿè®¡ç”¨æˆ·æ¶ˆè´¹æ’è¡Œ

```sql
SELECT
    u.id,
    u.username,
    COUNT(o.id) AS order_count,
    IFNULL(SUM(o.total_amount), 0) / 100 AS total_spent,
    IFNULL(AVG(o.total_amount), 0) / 100 AS avg_order_amount
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND o.status IN (2, 3, 4)
GROUP BY u.id, u.username
HAVING total_spent > 0
ORDER BY total_spent DESC
LIMIT 100;
```

### 5.4 ç»Ÿè®¡å•†å“é”€é‡æ’è¡Œ

```sql
SELECT
    p.id,
    p.name,
    IFNULL(SUM(oi.quantity), 0) AS total_sales,
    IFNULL(SUM(oi.subtotal), 0) / 100 AS total_revenue,
    COUNT(DISTINCT oi.order_id) AS order_count
FROM products p
LEFT JOIN order_items oi ON p.id = oi.product_id
GROUP BY p.id, p.name
ORDER BY total_sales DESC
LIMIT 50;
```

### 5.5 æŒ‰æ—¶é—´ç»´åº¦ç»Ÿè®¡

```sql
-- æŒ‰å°æ—¶ç»Ÿè®¡
SELECT
    HOUR(created_at) AS hour,
    COUNT(*) AS order_count
FROM orders
WHERE DATE(created_at) = CURDATE()
GROUP BY HOUR(created_at)
ORDER BY hour;

-- æŒ‰æ˜ŸæœŸå‡ ç»Ÿè®¡
SELECT
    DAYOFWEEK(created_at) AS day_of_week,
    CASE DAYOFWEEK(created_at)
        WHEN 1 THEN 'å‘¨æ—¥'
        WHEN 2 THEN 'å‘¨ä¸€'
        WHEN 3 THEN 'å‘¨äºŒ'
        WHEN 4 THEN 'å‘¨ä¸‰'
        WHEN 5 THEN 'å‘¨å››'
        WHEN 6 THEN 'å‘¨äº”'
        WHEN 7 THEN 'å‘¨å…­'
    END AS day_name,
    COUNT(*) AS order_count,
    SUM(total_amount) / 100 AS total_sales
FROM orders
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DAYOFWEEK(created_at)
ORDER BY day_of_week;

-- æŒ‰æœˆç»Ÿè®¡
SELECT
    DATE_FORMAT(created_at, '%Y-%m') AS month,
    COUNT(*) AS order_count,
    SUM(total_amount) / 100 AS total_sales
FROM orders
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
GROUP BY DATE_FORMAT(created_at, '%Y-%m')
ORDER BY month;
```

### 5.6 å¤šç»´åº¦ç»Ÿè®¡

```sql
-- æŒ‰åˆ†ç±»å’ŒçŠ¶æ€ç»Ÿè®¡å•†å“
SELECT
    category_id,
    status,
    COUNT(*) AS product_count,
    SUM(stock) AS total_stock,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY category_id, status
ORDER BY category_id, status;

-- æŒ‰åŸå¸‚å’Œæ€§åˆ«ç»Ÿè®¡ç”¨æˆ·
SELECT
    city,
    CASE gender
        WHEN 0 THEN 'æœªçŸ¥'
        WHEN 1 THEN 'ç”·'
        WHEN 2 THEN 'å¥³'
    END AS gender_text,
    COUNT(*) AS user_count,
    AVG(age) AS avg_age
FROM users
WHERE deleted_at IS NULL
GROUP BY city, gender
ORDER BY city, gender;
```

---

## å…­ã€é«˜çº§åˆ†ç»„æŠ€å·§

### 6.1 åˆ†ç»„æ¡ä»¶ç»Ÿè®¡

```sql
-- ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¢å•çŠ¶æ€åˆ†å¸ƒ
SELECT
    user_id,
    COUNT(*) AS total_orders,
    SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) AS pending_orders,
    SUM(CASE WHEN status = 2 THEN 1 ELSE 0 END) AS paid_orders,
    SUM(CASE WHEN status = 3 THEN 1 ELSE 0 END) AS shipped_orders,
    SUM(CASE WHEN status = 4 THEN 1 ELSE 0 END) AS completed_orders,
    SUM(CASE WHEN status = 5 THEN 1 ELSE 0 END) AS cancelled_orders
FROM orders
GROUP BY user_id;
```

### 6.2 åŠ¨æ€åˆ†ç»„ï¼ˆCASE WHENï¼‰

```sql
-- æŒ‰ä»·æ ¼åŒºé—´åˆ†ç»„ç»Ÿè®¡
SELECT
    CASE
        WHEN price_cents < 10000 THEN '0-100å…ƒ'
        WHEN price_cents >= 10000 AND price_cents < 50000 THEN '100-500å…ƒ'
        WHEN price_cents >= 50000 AND price_cents < 100000 THEN '500-1000å…ƒ'
        ELSE '1000å…ƒä»¥ä¸Š'
    END AS price_range,
    COUNT(*) AS product_count,
    AVG(price_cents) / 100 AS avg_price
FROM products
GROUP BY price_range
ORDER BY MIN(price_cents);

-- æŒ‰å¹´é¾„æ®µåˆ†ç»„ç»Ÿè®¡
SELECT
    CASE
        WHEN age < 18 THEN 'æœªæˆå¹´'
        WHEN age >= 18 AND age < 30 THEN '18-29å²'
        WHEN age >= 30 AND age < 40 THEN '30-39å²'
        WHEN age >= 40 AND age < 50 THEN '40-49å²'
        WHEN age >= 50 AND age < 60 THEN '50-59å²'
        ELSE '60å²ä»¥ä¸Š'
    END AS age_group,
    COUNT(*) AS user_count,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM users) AS percentage
FROM users
GROUP BY age_group
ORDER BY MIN(age);
```

### 6.3 ç™¾åˆ†æ¯”ç»Ÿè®¡

```sql
-- ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„å•†å“å æ¯”
SELECT
    category_id,
    COUNT(*) AS product_count,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM products) AS percentage,
    CONCAT(ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM products), 2), '%') AS percentage_text
FROM products
GROUP BY category_id
ORDER BY percentage DESC;
```

---

## ä¸ƒã€æœ¬ç« æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **èšåˆå‡½æ•°**ï¼š
   - COUNT(*)ï¼šç»Ÿè®¡è¡Œæ•°
   - SUMï¼šæ±‚å’Œ
   - AVGï¼šå¹³å‡å€¼
   - MAX/MINï¼šæœ€å¤§å€¼/æœ€å°å€¼
   - GROUP_CONCATï¼šæ‹¼æ¥

2. **GROUP BYåˆ†ç»„**ï¼š
   - å•å­—æ®µåˆ†ç»„
   - å¤šå­—æ®µåˆ†ç»„
   - ä¸ORDER BYã€LIMITç»„åˆ
   - WITH ROLLUPæ±‡æ€»

3. **HAVINGè¿‡æ»¤**ï¼š
   - WHEREè¿‡æ»¤åŸå§‹æ•°æ®
   - HAVINGè¿‡æ»¤åˆ†ç»„ç»“æœ
   - HAVINGå¯ä»¥ä½¿ç”¨èšåˆå‡½æ•°

4. **å¸¸è§é”™è¯¯**ï¼š
   - SELECTéåˆ†ç»„å­—æ®µ
   - WHEREä¸­ä½¿ç”¨èšåˆå‡½æ•°
   - ORDER BYéåˆ†ç»„å­—æ®µ

5. **å®æˆ˜åº”ç”¨**ï¼š
   - æŒ‰æ—¶é—´ç»´åº¦ç»Ÿè®¡
   - å¤šç»´åº¦ç»Ÿè®¡
   - æ¡ä»¶ç»Ÿè®¡
   - ç™¾åˆ†æ¯”ç»Ÿè®¡

### ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… ä½¿ç”¨èšåˆå‡½æ•°è¿›è¡Œç»Ÿè®¡
- âœ… ä½¿ç”¨GROUP BYè¿›è¡Œåˆ†ç»„æŸ¥è¯¢
- âœ… ä½¿ç”¨HAVINGè¿‡æ»¤åˆ†ç»„ç»“æœ
- âœ… è¿›è¡Œå¤šç»´åº¦æ•°æ®ç»Ÿè®¡åˆ†æ

ä¸‹ä¸€èŠ‚ï¼š[09-æ’åºä¸åˆ†é¡µ](./09-æ’åºä¸åˆ†é¡µ.md)
