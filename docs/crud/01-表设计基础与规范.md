# 01-表设计基础与规范

> 掌握数据库表设计的基础知识和规范，为后续学习打下坚实基础

---

## 📖 本章目标

- 理解数据库设计的完整流程
- 掌握表设计的命名规范
- 学会为不同业务场景选择合适的字段类型
- 理解字段属性的设计原则

---

## 一、数据库设计流程

### 1.1 设计流程概览

```
需求分析 → 概念设计 → 逻辑设计 → 物理设计 → 实施与维护
```

### 1.2 各阶段详解

**阶段一：需求分析**
- 明确业务需求
- 确定数据实体
- 识别实体关系
- 定义数据约束

**阶段二：概念设计**
- 绘制ER图（实体-关系图）
- 确定实体属性
- 定义实体关系（一对一、一对多、多对多）

**阶段三：逻辑设计**
- 将ER图转换为关系模型
- 定义表结构
- 确定字段类型
- 应用范式理论

**阶段四：物理设计**
- 选择存储引擎
- 设计索引策略
- 考虑性能优化
- 规划表分区

**阶段五：实施与维护**
- 创建数据库和表
- 导入初始数据
- 性能监控与调优
- 版本迭代管理

---

## 二、命名规范

### 2.1 数据库命名规范

**规则**：
- 使用小写字母
- 使用下划线分隔单词
- 见名知意
- 避免使用MySQL保留字

**示例**：
```sql
-- ✅ 推荐
CREATE DATABASE ecommerce_prod;
CREATE DATABASE blog_system;
CREATE DATABASE user_center;

-- ❌ 不推荐
CREATE DATABASE EcommerceDB;        -- 大小写混用
CREATE DATABASE ecommerce-prod;     -- 使用连字符
CREATE DATABASE db1;                -- 名称无意义
```

### 2.2 表命名规范

**规则**：
- 使用小写字母
- 使用下划线分隔单词
- 使用复数形式或单数形式（团队统一即可）
- 表名清晰表达业务含义
- 避免使用MySQL保留字

**示例**：
```sql
-- ✅ 推荐（使用复数）
CREATE TABLE users;           -- 用户表
CREATE TABLE orders;          -- 订单表
CREATE TABLE products;        -- 商品表

-- ✅ 推荐（使用单数）
CREATE TABLE user;            -- 用户表
CREATE TABLE order;           -- 订单表（注意：order是保留字，需加反引号）
CREATE TABLE product;         -- 商品表

-- ❌ 不推荐
CREATE TABLE UserInfo;        -- 大小写混用
CREATE TABLE tbl_user;        -- 无意义前缀
CREATE TABLE user_table;      -- 冗余后缀
```

**关联表命名**：
```sql
-- 多对多关联表：表1_表2（按字母顺序）
CREATE TABLE article_tags;    -- 文章-标签关联表
CREATE TABLE user_roles;      -- 用户-角色关联表

-- 或使用业务含义命名
CREATE TABLE subscriptions;   -- 订阅关系表
```

### 2.3 字段命名规范

**规则**：
- 使用小写字母
- 使用下划线分隔单词
- 见名知意
- 避免使用表名作为字段名前缀
- 避免使用MySQL保留字

**示例**：
```sql
-- ✅ 推荐
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ❌ 不推荐
CREATE TABLE users (
    userId BIGINT,                    -- 驼峰命名
    user_username VARCHAR(50),        -- 冗余前缀
    UserEmail VARCHAR(100),           -- 大小写混用
    desc TEXT                         -- 使用保留字
);
```

**常用字段命名**：
```sql
-- 主键
id                    -- 主键ID

-- 时间字段
created_at           -- 创建时间
updated_at           -- 更新时间
deleted_at           -- 删除时间（软删除）
published_at         -- 发布时间
expired_at           -- 过期时间

-- 状态字段
status               -- 状态
is_active            -- 是否激活
is_deleted           -- 是否删除
is_published         -- 是否发布

-- 计数字段
view_count           -- 浏览次数
like_count           -- 点赞次数
comment_count        -- 评论次数

-- 关联字段
user_id              -- 用户ID
category_id          -- 分类ID
parent_id            -- 父ID
```

### 2.4 索引命名规范

**规则**：
- 主键：PRIMARY KEY 或 pk_表名
- 唯一索引：uniq_表名_字段名
- 普通索引：idx_表名_字段名
- 联合索引：idx_表名_字段1_字段2

**示例**：
```sql
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    age TINYINT UNSIGNED,
    city VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- 唯一索引
    UNIQUE KEY uniq_username (username),
    UNIQUE KEY uniq_email (email),

    -- 普通索引
    INDEX idx_phone (phone),
    INDEX idx_city (city),

    -- 联合索引
    INDEX idx_city_age (city, age),
    INDEX idx_created_at (created_at)
);
```

---

## 三、字段类型选择原则

### 3.1 整型类型

#### 类型对比

| 类型 | 字节 | 有符号范围 | 无符号范围 | 适用场景 |
|------|------|-----------|-----------|----------|
| TINYINT | 1 | -128 ~ 127 | 0 ~ 255 | 年龄、状态、小范围计数 |
| SMALLINT | 2 | -32768 ~ 32767 | 0 ~ 65535 | 中等范围计数 |
| MEDIUMINT | 3 | -8388608 ~ 8388607 | 0 ~ 16777215 | 较大范围计数 |
| INT | 4 | -2147483648 ~ 2147483647 | 0 ~ 4294967295 | 常规ID、计数 |
| BIGINT | 8 | -2^63 ~ 2^63-1 | 0 ~ 2^64-1 | 大数据量ID、金额（分） |

#### 选择建议

```sql
-- ✅ 根据业务场景选择合适大小
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,     -- 用户ID：大数据量，使用BIGINT
    age TINYINT UNSIGNED,                              -- 年龄：0-255足够，使用TINYINT
    gender TINYINT UNSIGNED DEFAULT 0,                 -- 性别：0/1/2，使用TINYINT
    status TINYINT UNSIGNED DEFAULT 1,                 -- 状态：少量枚举值，使用TINYINT
    login_count INT UNSIGNED DEFAULT 0,                -- 登录次数：可能很大，使用INT
    balance BIGINT UNSIGNED DEFAULT 0                  -- 余额（分）：金额用BIGINT
);

-- ❌ 不推荐：浪费存储空间
CREATE TABLE users (
    age INT,              -- 年龄不需要INT，TINYINT足够
    gender INT,           -- 性别不需要INT
    status BIGINT         -- 状态不需要BIGINT
);
```

**最佳实践**：
1. **优先使用无符号类型（UNSIGNED）**：如果值不会为负数
2. **够用即可**：不要过度设计，选择能容纳业务数据的最小类型
3. **ID字段使用BIGINT UNSIGNED**：避免ID用尽的问题

### 3.2 字符串类型

#### 类型对比

| 类型 | 最大长度 | 存储方式 | 适用场景 |
|------|---------|---------|----------|
| CHAR(n) | 255字符 | 定长，不足补空格 | 固定长度：手机号、身份证号 |
| VARCHAR(n) | 65535字节 | 变长，存储实际长度+1或2字节 | 变长字符串：用户名、邮箱、标题 |
| TEXT | 64KB | 变长，存储在溢出页 | 长文本：文章内容、评论 |
| MEDIUMTEXT | 16MB | 变长 | 超大文本 |
| LONGTEXT | 4GB | 变长 | 极大文本 |

#### 选择建议

```sql
CREATE TABLE users (
    -- CHAR：固定长度字段
    phone CHAR(11),                          -- 手机号：固定11位
    id_card CHAR(18),                        -- 身份证号：固定18位
    country_code CHAR(2),                    -- 国家代码：固定2位

    -- VARCHAR：变长字段
    username VARCHAR(50) NOT NULL,           -- 用户名：变长，最大50
    email VARCHAR(100) NOT NULL,             -- 邮箱：变长，最大100
    nickname VARCHAR(50),                    -- 昵称：变长，最大50
    city VARCHAR(50),                        -- 城市：变长，最大50
    address VARCHAR(255),                    -- 地址：变长，最大255

    -- TEXT：长文本字段
    bio TEXT,                                -- 个人简介：长文本

    -- 注意：TEXT字段建议分离到扩展表
    profile_id BIGINT UNSIGNED               -- 关联user_profiles表
);

-- 用户资料扩展表（存储大字段）
CREATE TABLE user_profiles (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    bio TEXT,                                -- 个人简介
    description TEXT,                        -- 详细描述

    UNIQUE KEY uniq_user_id (user_id)
);
```

**CHAR vs VARCHAR 选择**：

```sql
-- ✅ 使用CHAR：固定长度，提高性能
phone CHAR(11)           -- 手机号固定11位
status CHAR(1)           -- 单字符状态

-- ✅ 使用VARCHAR：变长字符串，节省空间
username VARCHAR(50)     -- 用户名长度不固定
email VARCHAR(100)       -- 邮箱长度不固定
title VARCHAR(200)       -- 标题长度不固定

-- ❌ 不推荐
phone VARCHAR(11)        -- 手机号固定长度，应使用CHAR
bio VARCHAR(10000)       -- 长文本应使用TEXT
```

**VARCHAR长度设置**：

```sql
-- 根据业务需求设置合理长度
username VARCHAR(50)      -- 用户名：通常不超过50
email VARCHAR(100)        -- 邮箱：通常不超过100
title VARCHAR(200)        -- 标题：通常不超过200
url VARCHAR(500)          -- URL：可能较长
address VARCHAR(255)      -- 地址：较长

-- ❌ 避免过大或过小
username VARCHAR(5)       -- 太小，限制用户
username VARCHAR(1000)    -- 太大，浪费空间
```

### 3.3 时间日期类型

#### 类型对比

| 类型 | 字节 | 范围 | 时区 | 默认格式 | 适用场景 |
|------|------|------|------|---------|----------|
| DATE | 3 | 1000-01-01 ~ 9999-12-31 | 无 | YYYY-MM-DD | 生日、日期 |
| TIME | 3 | -838:59:59 ~ 838:59:59 | 无 | HH:MM:SS | 时间段 |
| DATETIME | 8 | 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59 | 无 | YYYY-MM-DD HH:MM:SS | 创建时间、更新时间 |
| TIMESTAMP | 4 | 1970-01-01 00:00:01 UTC ~ 2038-01-19 03:14:07 UTC | 有 | YYYY-MM-DD HH:MM:SS | 记录操作时间 |
| YEAR | 1 | 1901 ~ 2155 | 无 | YYYY | 年份 |

#### 选择建议

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,

    -- DATETIME：不受时区影响，推荐用于业务时间
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    -- DATE：只需要日期的场景
    birthday DATE COMMENT '生日',

    -- YEAR：只需要年份
    graduation_year YEAR COMMENT '毕业年份'
);

-- TIMESTAMP vs DATETIME 对比
CREATE TABLE logs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- TIMESTAMP：自动转换时区，但范围有限（2038年问题）
    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- DATETIME：不转换时区，范围更大（推荐）
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**最佳实践**：

1. **优先使用DATETIME**：
   - 范围更大（到9999年）
   - 不受时区影响
   - 更符合业务直觉

2. **标准时间字段**：
   ```sql
   created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
   updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
   ```

3. **软删除时间字段**：
   ```sql
   deleted_at DATETIME DEFAULT NULL COMMENT '删除时间'
   ```

### 3.4 浮点与定点类型

#### 类型对比

| 类型 | 字节 | 精度 | 适用场景 |
|------|------|------|----------|
| FLOAT | 4 | 单精度，约7位有效数字 | 科学计算、不需要精确的小数 |
| DOUBLE | 8 | 双精度，约15位有效数字 | 科学计算、不需要精确的小数 |
| DECIMAL(M,D) | 变长 | 精确小数 | 金额、需要精确计算的场景 |

#### 选择建议

```sql
CREATE TABLE products (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL,

    -- ✅ DECIMAL：金额必须使用DECIMAL，保证精度
    price DECIMAL(10, 2) NOT NULL COMMENT '价格（元）',
    -- DECIMAL(10, 2)：总共10位数字，小数点后2位
    -- 最大值：99999999.99（约1亿）

    -- ❌ 不要用FLOAT或DOUBLE存储金额
    -- price_wrong FLOAT,  -- 精度丢失，禁止使用

    -- ✅ DOUBLE：科学计算、不需要精确的场景
    weight DOUBLE COMMENT '重量（kg）',
    score DOUBLE COMMENT '评分'
);

-- 金额存储最佳实践
CREATE TABLE orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- 方式一：使用DECIMAL存储金额（推荐）
    amount DECIMAL(10, 2) NOT NULL COMMENT '订单金额（元）',

    -- 方式二：使用BIGINT存储分（更推荐，避免小数运算）
    amount_cents BIGINT UNSIGNED NOT NULL COMMENT '订单金额（分）'
);
```

**金额存储最佳实践**：

```sql
-- 推荐方式1：DECIMAL
price DECIMAL(10, 2)      -- 精确到分，最大99999999.99元

-- 推荐方式2：BIGINT存储分（最推荐）
price_cents BIGINT        -- 存储分，100 = 1元
-- 优点：避免浮点运算误差，计算速度快，存储空间小

-- 示例
CREATE TABLE products (
    id BIGINT UNSIGNED AUTO INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price_cents BIGINT UNSIGNED NOT NULL COMMENT '价格（分）',
    INDEX idx_price_cents (price_cents)
);

-- 插入数据：9.99元 = 999分
INSERT INTO products (name, price_cents) VALUES ('商品A', 999);

-- 查询：转换为元
SELECT
    name,
    price_cents,
    price_cents / 100.0 AS price_yuan
FROM products;
```

### 3.5 JSON类型（MySQL 5.7.8+）

#### JSON类型优势

- 自动验证JSON格式
- 高效的存储方式
- 支持JSON函数操作
- 支持索引（虚拟列）

#### 使用场景

```sql
CREATE TABLE products (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price_cents BIGINT UNSIGNED NOT NULL,

    -- JSON：存储商品属性（动态字段）
    attributes JSON COMMENT '商品属性',

    -- JSON：存储商品图片列表
    images JSON COMMENT '商品图片',

    -- JSON：存储扩展信息
    extra JSON COMMENT '扩展信息'
);

-- 插入数据
INSERT INTO products (name, price_cents, attributes, images) VALUES (
    'iPhone 15 Pro',
    899900,
    '{"color": "黑色", "storage": "256GB", "network": "5G"}',
    '["https://example.com/img1.jpg", "https://example.com/img2.jpg"]'
);

-- 查询JSON字段
SELECT
    name,
    price_cents / 100.0 AS price,
    JSON_EXTRACT(attributes, '$.color') AS color,
    JSON_EXTRACT(attributes, '$.storage') AS storage,
    JSON_LENGTH(images) AS image_count
FROM products;

-- 使用->简化查询
SELECT
    name,
    attributes->'$.color' AS color,
    attributes->>'$.storage' AS storage  -- ->>返回去引号的值
FROM products;
```

**JSON字段索引（虚拟列）**：

```sql
CREATE TABLE products (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    attributes JSON,

    -- 创建虚拟列
    color VARCHAR(50) AS (attributes->>'$.color') VIRTUAL,
    storage VARCHAR(50) AS (attributes->>'$.storage') VIRTUAL,

    -- 为虚拟列创建索引
    INDEX idx_color (color),
    INDEX idx_storage (storage)
);

-- 现在可以高效查询
SELECT * FROM products WHERE color = '黑色';
```

**何时使用JSON**：
- ✅ 扩展字段（属性不固定）
- ✅ 配置信息
- ✅ 日志数据
- ❌ 频繁查询的核心字段（应该独立字段）
- ❌ 需要关联查询的字段

---

## 四、字段属性设计

### 4.1 NULL vs NOT NULL

#### 原则

**默认使用NOT NULL**，除非业务上确实需要NULL

#### NULL的问题

```sql
-- 问题1：NULL的比较陷阱
SELECT * FROM users WHERE age = NULL;     -- ❌ 返回空，NULL不等于NULL
SELECT * FROM users WHERE age IS NULL;    -- ✅ 正确用法

-- 问题2：NULL影响聚合函数
CREATE TABLE test_null (
    id INT,
    score INT
);

INSERT INTO test_null VALUES (1, 80), (2, NULL), (3, 90);

SELECT COUNT(*) FROM test_null;           -- 3
SELECT COUNT(score) FROM test_null;       -- 2，忽略NULL
SELECT AVG(score) FROM test_null;         -- 85，(80+90)/2

-- 问题3：NULL影响索引
-- NULL值可能导致索引失效或性能下降
```

#### 最佳实践

```sql
-- ✅ 推荐：使用NOT NULL + 默认值
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL DEFAULT '',
    email VARCHAR(100) NOT NULL DEFAULT '',
    age TINYINT UNSIGNED NOT NULL DEFAULT 0,
    status TINYINT UNSIGNED NOT NULL DEFAULT 1,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ✅ 特殊情况：业务上确实需要NULL
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    deleted_at DATETIME DEFAULT NULL  -- 软删除：NULL表示未删除
);

-- ❌ 不推荐：随意使用NULL
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50),              -- 应该NOT NULL
    email VARCHAR(100),                -- 应该NOT NULL
    age INT                            -- 应该NOT NULL + DEFAULT
);
```

### 4.2 DEFAULT 默认值

#### 原则

为字段设置合理的默认值，减少插入时的麻烦

#### 常见默认值

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- 字符串：空字符串
    username VARCHAR(50) NOT NULL DEFAULT '',
    email VARCHAR(100) NOT NULL DEFAULT '',

    -- 数字：0或业务初始值
    age TINYINT UNSIGNED NOT NULL DEFAULT 0,
    balance BIGINT UNSIGNED NOT NULL DEFAULT 0,

    -- 状态：初始状态
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-正常，2-禁用',
    is_vip TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '是否VIP：0-否，1-是',

    -- 计数：0
    login_count INT UNSIGNED NOT NULL DEFAULT 0,
    view_count INT UNSIGNED NOT NULL DEFAULT 0,

    -- 时间：当前时间或NULL
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at DATETIME DEFAULT NULL
);
```

### 4.3 字符集和排序规则

#### 推荐配置

**MySQL 8.0**：
```sql
-- 数据库级别：utf8mb4
CREATE DATABASE ecommerce
    DEFAULT CHARACTER SET utf8mb4
    DEFAULT COLLATE utf8mb4_unicode_ci;

-- 表级别（继承数据库配置）
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 字段级别（特殊需求）
CREATE TABLE articles (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    -- 需要区分大小写的字段
    code VARCHAR(50) NOT NULL COLLATE utf8mb4_bin
);
```

**字符集选择**：
- ✅ **utf8mb4**：支持完整的Unicode（包括emoji）
- ❌ utf8：仅支持3字节UTF-8，不支持emoji

**排序规则选择**：
- **utf8mb4_unicode_ci**：Unicode排序，支持多语言（推荐）
- **utf8mb4_general_ci**：通用排序，性能略好
- **utf8mb4_bin**：二进制排序，区分大小写

### 4.4 注释规范

#### 原则

- 表必须有注释
- 重要字段必须有注释
- 枚举值必须在注释中说明

#### 示例

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    email VARCHAR(100) NOT NULL COMMENT '邮箱',
    phone VARCHAR(20) NOT NULL DEFAULT '' COMMENT '手机号',
    password VARCHAR(255) NOT NULL COMMENT '密码（加密）',

    age TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '年龄',
    gender TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '性别：0-未知，1-男，2-女',
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-正常，2-禁用，3-注销',

    balance BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '余额（分）',
    points INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '积分',

    last_login_at DATETIME DEFAULT NULL COMMENT '最后登录时间',
    last_login_ip VARCHAR(45) NOT NULL DEFAULT '' COMMENT '最后登录IP',

    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted_at DATETIME DEFAULT NULL COMMENT '删除时间',

    UNIQUE KEY uniq_username (username),
    UNIQUE KEY uniq_email (email),
    INDEX idx_phone (phone),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';

-- 查看表注释
SHOW CREATE TABLE users;

-- 查看字段注释
SHOW FULL COLUMNS FROM users;
```

---

## 五、实战案例

### 案例1：设计用户表

**需求**：
- 用户可以用用户名、邮箱、手机号注册和登录
- 记录用户基本信息：年龄、性别
- 记录用户状态：正常、禁用、注销
- 记录用户余额和积分
- 记录最后登录信息
- 记录创建、更新、删除时间

**表设计**：
```sql
CREATE TABLE users (
    -- 主键
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',

    -- 登录凭证（唯一）
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    email VARCHAR(100) NOT NULL COMMENT '邮箱',
    phone VARCHAR(20) NOT NULL DEFAULT '' COMMENT '手机号',
    password VARCHAR(255) NOT NULL COMMENT '密码（BCrypt加密）',

    -- 基本信息
    nickname VARCHAR(50) NOT NULL DEFAULT '' COMMENT '昵称',
    avatar VARCHAR(255) NOT NULL DEFAULT '' COMMENT '头像URL',
    age TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '年龄',
    gender TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '性别：0-未知，1-男，2-女',
    birthday DATE DEFAULT NULL COMMENT '生日',

    -- 状态
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-正常，2-禁用，3-注销',

    -- 资金
    balance BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '余额（分）',
    points INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '积分',

    -- 登录信息
    last_login_at DATETIME DEFAULT NULL COMMENT '最后登录时间',
    last_login_ip VARCHAR(45) NOT NULL DEFAULT '' COMMENT '最后登录IP',

    -- 时间戳
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted_at DATETIME DEFAULT NULL COMMENT '删除时间（软删除）',

    -- 索引
    UNIQUE KEY uniq_username (username),
    UNIQUE KEY uniq_email (email),
    INDEX idx_phone (phone),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

### 案例2：设计商品表

**需求**：
- 商品有基本信息：名称、描述、价格
- 商品有分类
- 商品有库存
- 商品有状态：上架、下架
- 商品有多张图片
- 商品有动态属性（颜色、尺寸等）
- 记录销量、浏览量

**表设计**：
```sql
CREATE TABLE products (
    -- 主键
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '商品ID',

    -- 基本信息
    name VARCHAR(200) NOT NULL COMMENT '商品名称',
    subtitle VARCHAR(255) NOT NULL DEFAULT '' COMMENT '副标题',
    description TEXT COMMENT '商品描述',

    -- 价格（分）
    price_cents BIGINT UNSIGNED NOT NULL COMMENT '价格（分）',
    original_price_cents BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '原价（分）',
    cost_cents BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '成本价（分）',

    -- 库存
    stock INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '库存数量',

    -- 分类
    category_id BIGINT UNSIGNED NOT NULL COMMENT '分类ID',

    -- 状态
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-上架，2-下架',

    -- 图片（JSON数组）
    images JSON COMMENT '商品图片',

    -- 动态属性（JSON对象）
    attributes JSON COMMENT '商品属性',

    -- 统计
    sales_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '销量',
    view_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '浏览量',

    -- 排序
    sort_order INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '排序序号',

    -- 时间戳
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted_at DATETIME DEFAULT NULL COMMENT '删除时间',

    -- 索引
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_price_cents (price_cents),
    INDEX idx_sales_count (sales_count),
    INDEX idx_sort_order (sort_order),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='商品表';
```

---

## 六、练习题

### 练习1：设计文章表

**需求**：
- 文章有标题、内容
- 文章有作者（关联用户表）
- 文章有分类
- 文章有状态：草稿、已发布
- 文章有发布时间
- 记录浏览量、点赞数、评论数

**请自行设计表结构**，参考答案见文末。

### 练习2：设计订单表

**需求**：
- 订单有订单号（唯一）
- 订单属于某个用户
- 订单有总金额
- 订单有支付方式：微信、支付宝、余额
- 订单有状态：待支付、已支付、已发货、已完成、已取消
- 记录支付时间、发货时间、完成时间

**请自行设计表结构**，参考答案见文末。

---

## 七、本章总结

### 核心要点

1. **命名规范**：
   - 小写字母 + 下划线分隔
   - 见名知意
   - 避免保留字

2. **字段类型选择**：
   - 够用即可，选择最小的类型
   - 金额用DECIMAL或BIGINT（分）
   - 时间用DATETIME
   - 动态属性用JSON

3. **字段属性**：
   - 默认使用NOT NULL
   - 设置合理的DEFAULT
   - 使用utf8mb4字符集
   - 添加完整的COMMENT

4. **索引设计**：
   - 主键：id
   - 唯一索引：唯一性约束字段
   - 普通索引：查询条件字段

### 下一步

完成本章学习后，你应该能够：
- ✅ 理解数据库设计流程
- ✅ 掌握命名规范
- ✅ 为不同场景选择合适的字段类型
- ✅ 设计规范的表结构

下一章我们将学习 **主键与索引设计**，深入理解索引的设计原则。

---

## 八、练习题参考答案

### 练习1答案：文章表

```sql
CREATE TABLE articles (
    -- 主键
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '文章ID',

    -- 基本信息
    title VARCHAR(200) NOT NULL COMMENT '标题',
    content TEXT NOT NULL COMMENT '内容',
    summary VARCHAR(500) NOT NULL DEFAULT '' COMMENT '摘要',
    cover_image VARCHAR(255) NOT NULL DEFAULT '' COMMENT '封面图',

    -- 作者
    author_id BIGINT UNSIGNED NOT NULL COMMENT '作者ID',

    -- 分类
    category_id BIGINT UNSIGNED NOT NULL COMMENT '分类ID',

    -- 状态
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-草稿，2-已发布',

    -- 发布时间
    published_at DATETIME DEFAULT NULL COMMENT '发布时间',

    -- 统计
    view_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '浏览量',
    like_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '点赞数',
    comment_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '评论数',

    -- 时间戳
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted_at DATETIME DEFAULT NULL COMMENT '删除时间',

    -- 索引
    INDEX idx_author_id (author_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_published_at (published_at),
    INDEX idx_view_count (view_count),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文章表';
```

### 练习2答案：订单表

```sql
CREATE TABLE orders (
    -- 主键
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',

    -- 订单号（唯一）
    order_no VARCHAR(32) NOT NULL COMMENT '订单号',

    -- 用户
    user_id BIGINT UNSIGNED NOT NULL COMMENT '用户ID',

    -- 金额（分）
    total_amount BIGINT UNSIGNED NOT NULL COMMENT '总金额（分）',
    pay_amount BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '实付金额（分）',
    discount_amount BIGINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '优惠金额（分）',

    -- 支付方式
    pay_method TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '支付方式：0-未支付，1-微信，2-支付宝，3-余额',

    -- 状态
    status TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '状态：1-待支付，2-已支付，3-已发货，4-已完成，5-已取消',

    -- 时间
    paid_at DATETIME DEFAULT NULL COMMENT '支付时间',
    shipped_at DATETIME DEFAULT NULL COMMENT '发货时间',
    completed_at DATETIME DEFAULT NULL COMMENT '完成时间',
    cancelled_at DATETIME DEFAULT NULL COMMENT '取消时间',

    -- 备注
    user_remark VARCHAR(255) NOT NULL DEFAULT '' COMMENT '用户备注',
    admin_remark VARCHAR(255) NOT NULL DEFAULT '' COMMENT '管理员备注',

    -- 时间戳
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    -- 索引
    UNIQUE KEY uniq_order_no (order_no),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_paid_at (paid_at),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='订单表';
```

---

**🎉 恭喜完成第一节学习！**

下一节：[02-主键与索引设计](./02-主键与索引设计.md)
