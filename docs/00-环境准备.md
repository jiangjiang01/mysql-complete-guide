# MySQL å®æ“ç¯å¢ƒå‡†å¤‡

> 5åˆ†é’Ÿå¿«é€Ÿæ­å»ºMySQLå­¦ä¹ ç¯å¢ƒï¼Œç„¶åå¼€å§‹å­¦ä¹ ï¼
>
> **æœ¬æ•™ç¨‹ä½¿ç”¨Dockeræ–¹å¼ï¼Œç®€å•ã€å¹²å‡€**

---

## å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥æå®šï¼‰

### æ­¥éª¤1ï¼šå¯åŠ¨MySQLå®¹å™¨

```bash
docker run --name mysql-study \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v ~/mysql-study/data:/var/lib/mysql \
  -d mysql:8.0 \
  --character-set-server=utf8mb4 \
  --collation-server=utf8mb4_unicode_ci \
  --log-bin=mysql-bin \
  --binlog-format=ROW \
  --server-id=1
```

ç­‰å¾…10ç§’è®©MySQLå¯åŠ¨å®Œæˆã€‚

### æ­¥éª¤2ï¼šè¿æ¥MySQL

```bash
docker exec -it mysql-study mysql -uroot -p123456
```

### æ­¥éª¤3ï¼šåˆ›å»ºå­¦ä¹ æ•°æ®åº“

åœ¨MySQLä¸­æ‰§è¡Œï¼š

```sql
-- åˆ›å»ºå­¦ä¹ æ•°æ®åº“
CREATE DATABASE mysql_study DEFAULT CHARACTER SET utf8mb4;

-- åˆ‡æ¢åˆ°å­¦ä¹ æ•°æ®åº“
USE mysql_study;

-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    age INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO users (name, age) VALUES
('å¼ ä¸‰', 25),
('æå››', 30),
('ç‹äº”', 28);

-- éªŒè¯
SELECT * FROM users;
```

çœ‹åˆ°3æ¡æ•°æ®ï¼Ÿ**ç¯å¢ƒæ­å»ºå®Œæˆï¼** ç°åœ¨å¯ä»¥å¼€å§‹å­¦ä¹  `01-æ¶æ„ä¸æ—¥å¿—ç³»ç»Ÿ.md` äº†ï¼

---

## å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨å®¹å™¨
docker start mysql-study

# åœæ­¢å®¹å™¨
docker stop mysql-study

# é‡å¯å®¹å™¨
docker restart mysql-study

# è¿æ¥MySQL
docker exec -it mysql-study mysql -uroot -p123456

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a | grep mysql-study

# æŸ¥çœ‹æ—¥å¿—
docker logs mysql-study
```

---

## éªŒè¯ç¯å¢ƒï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³éªŒè¯binlogç­‰é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š

```sql
-- éªŒè¯binlogæ˜¯å¦å¼€å¯
SHOW VARIABLES LIKE 'log_bin';
-- åº”è¯¥æ˜¾ç¤º ON

-- éªŒè¯binlogæ ¼å¼
SHOW VARIABLES LIKE 'binlog_format';
-- åº”è¯¥æ˜¾ç¤º ROW

-- æŸ¥çœ‹MySQLç‰ˆæœ¬
SELECT VERSION();

-- æŸ¥çœ‹å­—ç¬¦é›†
SHOW VARIABLES LIKE 'character%';
```

---

## ç¯å¢ƒè¯´æ˜

- **æ•°æ®å­˜å‚¨**ï¼š`~/mysql-study/data/`ï¼ˆåœ¨ä½ çš„Macä¸Šï¼‰
- **rootå¯†ç **ï¼š`123456`
- **ç«¯å£**ï¼š`3306`
- **MySQLç‰ˆæœ¬**ï¼š8.0
- **å­—ç¬¦é›†**ï¼šutf8mb4

---

## é‡åˆ°é—®é¢˜ï¼Ÿ

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs mysql-study

# ç«¯å£è¢«å ç”¨ï¼Ÿæ”¹ç”¨å…¶ä»–ç«¯å£
docker run --name mysql-study \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3307:3306 \
  -v ~/mysql-study/data:/var/lib/mysql \
  -d mysql:8.0 \
  --character-set-server=utf8mb4
```

### è¿æ¥è¢«æ‹’ç»

```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps | grep mysql-study

# å¦‚æœæ²¡è¿è¡Œï¼Œå¯åŠ¨å®ƒ
docker start mysql-study
```

### é‡æ–°å¼€å§‹

```bash
# åˆ é™¤å®¹å™¨å’Œæ•°æ®ï¼Œé‡æ–°æ¥è¿‡
docker rm -f mysql-study
rm -rf ~/mysql-study/data
# ç„¶åé‡æ–°æ‰§è¡Œæ­¥éª¤1
```

---

## é™„å½•ï¼šé«˜çº§é…ç½®ï¼ˆæŒ‰éœ€æŸ¥çœ‹ï¼‰

<details>
<summary>ç‚¹å‡»å±•å¼€ï¼šå®Œæ•´é…ç½®æ–‡ä»¶æ–¹å¼</summary>

å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„é…ç½®æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶æ–¹å¼ï¼š

```bash
# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p ~/mysql-study/{conf,data,logs}

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > ~/mysql-study/conf/my.cnf << 'EOF'
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
default-time-zone='+8:00'
server-id=1

# binlogé…ç½®
log-bin=mysql-bin
binlog_format=ROW
sync_binlog=1

# redo logé…ç½®
innodb_flush_log_at_trx_commit=1

# æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log=1
slow_query_log_file=/var/log/mysql/mysql-slow.log
long_query_time=2

# æ€§èƒ½é…ç½®
innodb_buffer_pool_size=1G
max_connections=200

[mysql]
default-character-set=utf8mb4

[client]
default-character-set=utf8mb4
EOF

# å¯åŠ¨å®¹å™¨ï¼ˆæŒ‚è½½é…ç½®æ–‡ä»¶ï¼‰
docker run --name mysql-study \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v ~/mysql-study/conf/my.cnf:/etc/mysql/conf.d/my.cnf \
  -v ~/mysql-study/data:/var/lib/mysql \
  -v ~/mysql-study/logs:/var/log/mysql \
  -d mysql:8.0
```

</details>

<details>
<summary>ç‚¹å‡»å±•å¼€ï¼šæ•°æ®å¤‡ä»½ä¸æ¢å¤</summary>

### å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½å•ä¸ªæ•°æ®åº“
docker exec -e MYSQL_PWD=123456 mysql-study mysqldump -uroot \
  --single-transaction \
  mysql_study > ~/mysql-study-backup.sql

# å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
docker exec -e MYSQL_PWD=123456 mysql-study mysqldump -uroot \
  --all-databases \
  --single-transaction \
  > ~/mysql-all-backup.sql
```

### æ¢å¤æ•°æ®åº“

```bash
# æ¢å¤æ•°æ®åº“
docker exec -i -e MYSQL_PWD=123456 mysql-study mysql -uroot mysql_study \
  < ~/mysql-study-backup.sql
```

</details>

<details>
<summary>ç‚¹å‡»å±•å¼€ï¼šæŸ¥çœ‹binlog</summary>

```bash
# æŸ¥çœ‹binlogåˆ—è¡¨
docker exec -e MYSQL_PWD=123456 mysql-study mysql -uroot \
  -e "SHOW BINARY LOGS;"

# æŸ¥çœ‹binlogå†…å®¹
docker exec -e MYSQL_PWD=123456 mysql-study mysql -uroot \
  -e "SHOW BINLOG EVENTS IN 'mysql-bin.000001' LIMIT 10;"
```

</details>

<details>
<summary>ç‚¹å‡»å±•å¼€ï¼šæ€§èƒ½ç›‘æ§å‘½ä»¤</summary>

```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥
SHOW FULL PROCESSLIST;

-- æŸ¥çœ‹InnoDBçŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°é‡
SHOW GLOBAL STATUS LIKE 'Slow_queries';

-- æŸ¥çœ‹buffer poolä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Innodb_buffer_pool%';
```

</details>

---

**å‡†å¤‡å®Œæˆï¼å¼€å§‹å­¦ä¹  â†’ `01-æ¶æ„ä¸æ—¥å¿—ç³»ç»Ÿ.md`** ğŸš€
